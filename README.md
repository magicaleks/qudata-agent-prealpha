# QuData Agent

GPU-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π NVIDIA GPU, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π SSH –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º —Ä–µ—Å—É—Ä—Å–æ–≤.

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### One-line —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
curl -fsSL https://raw.githubusercontent.com/magicaleks/qudata-agent-prealpha/main/install.sh | sudo bash -s YOUR_API_KEY
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
wget https://raw.githubusercontent.com/magicaleks/qudata-agent-prealpha/main/install.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo bash install.sh YOUR_API_KEY
```
–∞
## üìã –ß—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: git, curl, wget, ethtool, dmidecode –∏ –¥—Ä.
2. **Python 3.10+**: –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
3. **Docker**: –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
4. **NVIDIA –¥—Ä–∞–π–≤–µ—Ä—ã** (–µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω GPU): nvidia-driver-535
5. **NVIDIA Container Toolkit**: –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ GPU –≤ Docker
6. **QuData Agent**: –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
7. **Systemd —Å–µ—Ä–≤–∏—Å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–û–°**: Ubuntu 22.04 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–ü—Ä–∞–≤–∞**: root/sudo
- **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç**: –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤
- **GPU** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): NVIDIA GPU –¥–ª—è GPU-–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–º

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (real-time)
```bash
# Journald –ª–æ–≥–∏
sudo journalctl -u qudata-agent -f

# –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏
sudo tail -f /opt/qudata-agent/logs.txt
```

### –°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞
```bash
sudo systemctl status qudata-agent
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞/–∑–∞–ø—É—Å–∫/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
sudo systemctl stop qudata-agent
sudo systemctl start qudata-agent
sudo systemctl restart qudata-agent
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
```bash
cd /opt/qudata-agent
sudo git pull origin main
sudo systemctl restart qudata-agent
```

## üì° API Endpoints

### `GET /ping`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞–≥–µ–Ω—Ç–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "data": null
}
```

### `POST /instances`
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "image": "nvidia/cuda:12.6.1-base-ubuntu22.04",
  "image_tag": "latest",
  "storage_gb": 10,
  "env_variables": {
    "QUDATA_CPU_CORES": "4",
    "QUDATA_MEMORY_GB": "8",
    "QUDATA_GPU_COUNT": "1"
  },
  "ports": {
    "8080": "auto",
    "3000": "3000"
  },
  "command": null,
  "ssh_enabled": true
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "data": {
    "success": true,
    "ports": {
      "22": "1025",
      "8080": "32768",
      "3000": "3000"
    }
  }
}
```

### `GET /instances?logs=true`
–ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ (—Å –ª–æ–≥–∞–º–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "data": {
    "instance_id": "uuid",
    "container_id": "docker_id",
    "status": "running",
    "allocated_ports": {"22": "1025"},
    "logs": "container logs..."
  }
}
```

### `PUT /instances`
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º (stop/start/restart)

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "action": "stop"
}
```

### `DELETE /instances`
–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### SSH Endpoints

#### `POST /ssh`
–î–æ–±–∞–≤–∏—Ç—å SSH –∫–ª—é—á –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "ssh_pubkey": "ssh-rsa AAAAB3NzaC1yc2EA... user@host"
}
```

#### `DELETE /ssh`
–£–¥–∞–ª–∏—Ç—å SSH –∫–ª—é—á –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "ssh_pubkey": "ssh-rsa AAAAB3NzaC1yc2EA... user@host"
}
```

#### `GET /ssh`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ SSH –∫–ª—é—á–µ–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "data": {
    "keys": [
      "ssh-rsa AAAAB3NzaC1yc2EA...",
      "ssh-ed25519 AAAAC3NzaC1lZDI1..."
    ]
  }
}
```

## üîê SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É

1. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Å—Ç–∞–Ω—Å —Å `ssh_enabled: true`
2. –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —á–µ—Ä–µ–∑ `POST /ssh`
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å: `ssh root@<agent_ip> -p <ssh_port>`

–ü—Ä–∏–º–µ—Ä:
```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Ä—Ç SSH
curl http://agent_ip:port/instances | jq '.data.allocated_ports["22"]'

# –î–æ–±–∞–≤–∏—Ç—å SSH –∫–ª—é—á
curl -X POST http://agent_ip:port/ssh \
  -H "Content-Type: application/json" \
  -d '{"ssh_pubkey": "ssh-rsa AAAAB3... user@host"}'

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
ssh root@agent_ip -p 1025
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã:
- **CPU utilization** (%)
- **RAM utilization** (%)
- **Container status** (running/paused/error)

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (stop/start/restart).

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
qudata-agent/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ install.sh             # –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ secret_key.json        # API –∫–ª—é—á (—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ)
‚îú‚îÄ‚îÄ logs.txt               # –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ client/            # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API
    ‚îú‚îÄ‚îÄ server/            # Falcon ASGI —Å–µ—Ä–≤–µ—Ä
    ‚îú‚îÄ‚îÄ service/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ instances.py   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ ssh_setup.py   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
    ‚îÇ   ‚îú‚îÄ‚îÄ ssh_keys.py    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSH –∫–ª—é—á–∞–º–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ gpu_info.py    # –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ GPU
    ‚îÇ   ‚îú‚îÄ‚îÄ health.py      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
    ‚îÇ   ‚îî‚îÄ‚îÄ system_check.py # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
    ‚îú‚îÄ‚îÄ storage/           # –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
    ‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### SSH Setup (—Ñ–æ–Ω–æ–≤—ã–π)
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å `ssh_enabled: true` –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `openssh-server`
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç SSH daemon
- –°–æ–∑–¥–∞–µ—Ç `.ssh/authorized_keys`
- –ó–∞–ø—É—Å–∫–∞–µ—Ç SSH —Å–µ—Ä–≤–µ—Ä

–ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ, –æ—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É.

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
–ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å Docker:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã
- –û—á–∏—â–∞–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

### Graceful Shutdown
–ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∞–≥–µ–Ω—Ç–∞ (SIGTERM/SIGINT):
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç HTTP —Å–µ—Ä–≤–µ—Ä

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Docker
```bash
sudo systemctl status docker
sudo docker ps -a
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ NVIDIA GPU
```bash
nvidia-smi
sudo docker run --rm --gpus all nvidia/cuda:12.6.1-base-ubuntu22.04 nvidia-smi
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—à–∏–±–æ–∫
```bash
sudo journalctl -u qudata-agent -n 100 --no-pager
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
```bash
cd /opt/qudata-agent
sudo python3 main.py YOUR_API_KEY
```

## üî• –£–¥–∞–ª–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl stop qudata-agent
sudo systemctl disable qudata-agent
sudo rm /etc/systemd/system/qudata-agent.service
sudo systemctl daemon-reload

# –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
sudo rm -rf /opt/qudata-agent
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `/opt/qudata-agent/secret_key.json` —Å –ø—Ä–∞–≤–∞–º–∏ 600
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å `tail -f /dev/null` (idle mode)
- –ü—Ä–∏ stop –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞)
- –û–±—Ä–∞–∑—ã Docker —Å —Ç–µ–≥–æ–º –≤ –∏–º–µ–Ω–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä `nvidia/cuda:12.6.1-base-ubuntu22.04`)

## üõ†Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

| –î–µ–π—Å—Ç–≤–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `create` | –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `stop` | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è) |
| `start` | –ó–∞–ø—É—Å–∫ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `restart` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `delete` | –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u qudata-agent -f`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Docker: `sudo docker ps -a`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
4. –°–æ–∑–¥–∞–π—Ç–µ issue –Ω–∞ GitHub
